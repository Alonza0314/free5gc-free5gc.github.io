<!DOCTYPE html>
<html lang="en" >

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


<meta property="og:title" content="" />
<meta property="og:description" content="Creating a free5GC VM and Setting up Network In this demo we will exercise:
 Cloning an existing VM, and install free5GC on it Setting up the networking for the free5GC VM  Refer to video Clone VM and Change IP
1. Check up an existing VM for Cloning Launch VirtualBox, and make sure the Ubuntu VM (ubuntu) we created before can boot up, then:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.free5gc.org/installations/stage-3-free5gc-vm/" />




<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="Creating a free5GC VM and Setting up Network In this demo we will exercise:
 Cloning an existing VM, and install free5GC on it Setting up the networking for the free5GC VM  Refer to video Clone VM and Change IP
1. Check up an existing VM for Cloning Launch VirtualBox, and make sure the Ubuntu VM (ubuntu) we created before can boot up, then:"/>
<meta name="generator" content="Hugo 0.80.0" />

    
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "",
  "url": "https://www.free5gc.org/installations/stage-3-free5gc-vm/",
  "wordCount": "887",
  "datePublished": "0001-01-01T00:00:00+00:00",
  "author": {
    "@type": "Person",
    "name": "free5GC.ofg"
  }
}
</script>



    <link rel="canonical" href="https://www.free5gc.org/installations/stage-3-free5gc-vm/">

    <title> | free5GC</title>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">

    <!-- combined, minified CSS -->
    
    <link href="https://www.free5gc.org/css/bootstrap-icons.0799fcdcc0b7a1f7165b6d7dd1ea2280de895281badebe34845b3691a0910b0a.css" rel="stylesheet">
    
    <link href="https://www.free5gc.org/css/style.d8d3ca46b31f5e445f452e8cbf40915b1bbc4cd870640af474cc10b8b6dfaa22.css" rel="stylesheet">

    <!-- minified base javascript -->
    
    <script defer src="https://www.free5gc.org/js/base.6d4e3026ad8b475550ec72166dad66ce7e1ca14bc425122ad42fef1d9ca82f67.js" crossorigin="anonymous"></script>

    

  </head>

  <body>

    
    <header class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom shadow-sm">
      <p class="h5 my-0 me-md-auto fw-normal">
        <a class="nav-link " href="https://www.free5gc.org">
          <img src="/img/free5GC.png" width="217" height="51">
        </a>
      </p>
      <nav class="btn-group" role="group" aria-label="Basic outlined example">
          
          <a class="btn btn-outline-primary"
             href="/" title="Home">Home</a>
          
        
          
          <a class="btn btn-outline-primary"
             href="/roadmap/" title="Roadmap">Roadmap</a>
          
        
          
          <div id="btn-group-install" class="btn-group" role="group">
            <button type="button"
                    class="btn btn-outline-primary dropdown-toggle active"
                    data-bs-toggle="dropdown" aria-expanded="false">
              Installations
            </button>
            <ul class="dropdown-menu" aria-labelledby="btn-group-install">
              
              <li><a class="dropdown-item"
                     
                     title="Stage 1: Cluster"
                     href="/installations/stage-1-cluster/">Stage 1: Cluster</a></li>
              
              <li><a class="dropdown-item"
                     
                     title="Stage 1: All-in-one"
                     href="/installations/stage-1-all-in-one/">Stage 1: All-in-one</a></li>
              
              <li><a class="dropdown-item"
                     
                     title="Stage 2: Standalone 5G"
                     href="/installations/stage-2-standalone-5g/">Stage 2: Standalone 5G</a></li>
              
              <li><a class="dropdown-item"
                     
                     title="Stage 3: free5GC"
                     href="/installations/stage-3/">Stage 3: free5GC</a></li>
              
            </ul>
          </div>
          
        
          
          <a class="btn btn-outline-primary"
             href="/membership/" title="Membership">Membership</a>
          
        
          
          <a class="btn btn-outline-primary"
             href="/contactus/" title="Contact Us">Contact Us</a>
          
        
          
          <div id="btn-group-more" class="btn-group" role="group">
            <button type="button"
                    class="btn btn-outline-primary dropdown-toggle"
                    data-bs-toggle="dropdown" aria-expanded="false">
              More
            </button>
            <ul class="dropdown-menu" aria-labelledby="btn-group-more">
              
              <li><a class="dropdown-item"
                     target="_blank"
                     title="Download"
                     href="https://github.com/free5gc/free5gc">Download</a></li>
              
                     <li>
                      <a
                        class="dropdown-item"
                        target="_blank"
                        title="Youtube"
                        href="https://www.youtube.com/channel/UCywP5Acj50GlhSxZTJXlqtw/videos"
                        >Youtube Videos</a
                      >
                    </li>
        
                    <li>
                      <a class="dropdown-item" title="History" href="/otherVideo/"
                        >Other Videos</a
                      >
                    </li>
              
              <li><a class="dropdown-item"
                     target="_blank"
                     title="free5GC Forum"
                     href="https://forum.free5gc.org/">free5GC Forum</a></li>
              
              <li><a class="dropdown-item"
                     
                     title="History"
                     href="/history/">History</a></li>
              
            </ul>
          </div>
          
        
      </nav>
    </header>
    

    <div class="container-fluid mx-auto" style="max-width: 960px;">

      


<article class="blog-post">
  <header>
    <h2 class="blog-post-title" dir="auto"><a href="https://www.free5gc.org/installations/stage-3-free5gc-vm/"></a></h2>
    <p class="blog-post-meta">

</p>
  </header>
  <h1 id="creating-a-free5gc-vm-and-setting-up-network">Creating a free5GC VM and Setting up Network</h1>
<p>In this demo we will exercise:</p>
<ul>
<li>Cloning an existing VM, and install free5GC on it</li>
<li>Setting up the networking for the free5GC VM</li>
</ul>
<p>Refer to video <a href="/stage-3-videos/clone-change-ip/" target="_blank">Clone VM and Change IP</a></p>
<h2 id="1-check-up-an-existing-vm-for-cloning">1. Check up an existing VM for Cloning</h2>
<p>Launch VirtualBox, and make sure the Ubuntu VM (ubuntu) we created before
can boot up, then:</p>
<ul>
<li>Log in into the VM using SSH from the host machine, and check if the VM
has internet access</li>
<li>Make sure you have done <code>sudo apt update</code> and <code>sudo apt upgrade</code> (or
you can do it again)</li>
<li>Shutdown the VM. You can:
<ul>
<li>use command <code>sudo shutdown -P now</code>, or</li>
<li>click the &ldquo;Close Window&rdquo; of the Ubuntu VM terminal and choose the
middle option (better not force to turn off the machine power)</li>
<li>later if you just want to reboot, enter <code>sudo shutdown -r now</code></li>
</ul>
</li>
</ul>
<h2 id="2-create-a-free5gc-vm">2. Create a free5GC VM</h2>
<p>First let&rsquo;s clone a new VM:</p>
<ul>
<li>Select an existing VM (ubuntu) and click the buttons on the right:
/ Snapshopts / Clone</li>
<li>Name the new VM <code>free5gc</code></li>
<li>The MAC address rule: Create new MAC addresses for all network cards</li>
<li>Choose the Link cloning option (or you can also choose to complete clone
the VM if you like)</li>
</ul>
<p>After the new VM is created:</p>
<ul>
<li>Start up the new free5gc VM, and use the same username and password to log in</li>
<li>In the Ubuntu terminal, issue <code>ping</code> and <code>ifconfig</code> again to make sure it
has internet access,
and also make note of the IP address of the Host-only network interface
<ul>
<li>for example the IP could still be <code>192.168.56.101</code>, and the
interface name is <code>enp0s8</code></li>
</ul>
</li>
<li>Log in into free5gc VM using SSH, and make sure all things working properly</li>
</ul>
<h2 id="3-change-hostname">3. Change hostname</h2>
<p>The cloned free5gc VM still has host name <code>ubuntu</code> (or the name you gave it
in the original VM). Let&rsquo;s rename the VM to <code>free5gc</code>. You can do this by
editing the file <code>/etc/hostname</code> (using <code>vi</code> or <code>nano</code>):</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">sudo nano /etc/hostname  <span style="color:#60a0b0;font-style:italic"># or sudo vi /etc/hostname</span>
</code></pre></div><p>In the file, change <code>ubuntu</code> into <code>free5gc</code>。If you are using <code>nano</code> ，you can
press Ctrl-O to save the file, then Ctrl-X to exit.</p>
<p>Let&rsquo;s also change the file <code>/etc/hosts</code> by replacing the <code>ubuntu</code> inside into
<code>free5gc</code>:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">sudo nano /etc/hosts
</code></pre></div><p>New content of the file <code>/etc/hosts</code> looks like this:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">127.0.0.1 localhost
127.0.1.1 free5gc

    ...
</code></pre></div><p>The changes will take effect after next reboot.</p>
<h2 id="4-setting-static-ip-address">4. Setting Static IP Address</h2>
<p>The Host-only network interface, by default, gets its IP address through DHCP.
The cloned free5gc VM seems to have trouble obtaining new IP address.
We can change the host-only interface to use static IP address instead, which can
save a lot of trouble later.</p>
<p>Here let&rsquo;s fix the static IP address as <code>192.168.56.101</code>:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">$ <span style="color:#007020">cd</span> /etc/netplan
$ ls
00-installer-config.yaml
$ cat 00-installer-config.yaml
</code></pre></div><p>The original content of the file <code>00-installer-config.yaml</code> looks like:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash"><span style="color:#60a0b0;font-style:italic"># This is the network config written by &#39;subiquity&#39;</span>
network:
  ethernets:
    enp0s3:
      dhcp4: <span style="color:#007020">true</span>
    enp0s8:
      dhcp4: <span style="color:#007020">true</span>
  version: <span style="color:#40a070">2</span>
</code></pre></div><p>meaning the VM has two network interfaces. Using <code>ifconfig</code> we know that
<code>enp0s8</code> is the name of the Host-only network interface. We can edit the file:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">sudo nano 00-installer-config.yaml
</code></pre></div><p>and change it into:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash"><span style="color:#60a0b0;font-style:italic"># This is the network config written by &#39;subiquity&#39;</span>
network:
  ethernets:
    enp0s3:
      dhcp4: <span style="color:#007020">true</span>
    enp0s8:
      dhcp4: no
      addresses: <span style="color:#666">[</span>192.168.56.101/24<span style="color:#666">]</span>
  version: <span style="color:#40a070">2</span>
</code></pre></div><p>First check if the new content is correct:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">sudo netplan try
</code></pre></div><p>Press enter to exit, if successful. The apply tne new interface setting:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">sudo netplan apply
</code></pre></div><p>Run <code>ifconfig</code> to see if the network setting has been changed correctly:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">enp0s3: <span style="color:#bb60d5">flags</span><span style="color:#666">=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span style="color:#40a070">1500</span>
        inet 10.0.2.15  netmask 255.255.255.0  broadcast 10.0.2.255
        inet6 fe80::a00:27ff:fec4:254f  prefixlen <span style="color:#40a070">64</span>  scopeid 0x20&lt;link&gt;
        ether 08:00:27:c4:25:4f  txqueuelen <span style="color:#40a070">1000</span>  <span style="color:#666">(</span>Ethernet<span style="color:#666">)</span>
        RX packets <span style="color:#40a070">2</span>  bytes <span style="color:#40a070">1180</span> <span style="color:#666">(</span>1.1 KB<span style="color:#666">)</span>
        RX errors <span style="color:#40a070">0</span>  dropped <span style="color:#40a070">0</span>  overruns <span style="color:#40a070">0</span>  frame <span style="color:#40a070">0</span>
        TX packets <span style="color:#40a070">18</span>  bytes <span style="color:#40a070">1894</span> <span style="color:#666">(</span>1.8 KB<span style="color:#666">)</span>
        TX errors <span style="color:#40a070">0</span>  dropped <span style="color:#40a070">0</span> overruns <span style="color:#40a070">0</span>  carrier <span style="color:#40a070">0</span>  collisions <span style="color:#40a070">0</span>

enp0s8: <span style="color:#bb60d5">flags</span><span style="color:#666">=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span style="color:#40a070">1500</span>
        inet 192.168.56.101  netmask 255.255.255.0  broadcast 192.168.56.255
        inet6 fe80::a00:27ff:fe7e:ada6  prefixlen <span style="color:#40a070">64</span>  scopeid 0x20&lt;link&gt;
        ether 08:00:27:7e:ad:a6  txqueuelen <span style="color:#40a070">1000</span>  <span style="color:#666">(</span>Ethernet<span style="color:#666">)</span>
        RX packets <span style="color:#40a070">8420</span>  bytes <span style="color:#40a070">531867</span> <span style="color:#666">(</span>531.8 KB<span style="color:#666">)</span>
        RX errors <span style="color:#40a070">0</span>  dropped <span style="color:#40a070">0</span>  overruns <span style="color:#40a070">0</span>  frame <span style="color:#40a070">0</span>
        TX packets <span style="color:#40a070">10887</span>  bytes <span style="color:#40a070">823487</span> <span style="color:#666">(</span>823.4 KB<span style="color:#666">)</span>
        TX errors <span style="color:#40a070">0</span>  dropped <span style="color:#40a070">0</span> overruns <span style="color:#40a070">0</span>  carrier <span style="color:#40a070">0</span>  collisions <span style="color:#40a070">0</span>

lo: <span style="color:#bb60d5">flags</span><span style="color:#666">=</span>73&lt;UP,LOOPBACK,RUNNING&gt;  mtu <span style="color:#40a070">65536</span>
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen <span style="color:#40a070">128</span>  scopeid 0x10&lt;host&gt;
        loop  txqueuelen <span style="color:#40a070">1000</span>  <span style="color:#666">(</span>Local Loopback<span style="color:#666">)</span>
        RX packets <span style="color:#40a070">6621</span>  bytes <span style="color:#40a070">596035</span> <span style="color:#666">(</span>596.0 KB<span style="color:#666">)</span>
        RX errors <span style="color:#40a070">0</span>  dropped <span style="color:#40a070">0</span>  overruns <span style="color:#40a070">0</span>  frame <span style="color:#40a070">0</span>
        TX packets <span style="color:#40a070">6621</span>  bytes <span style="color:#40a070">596035</span> <span style="color:#666">(</span>596.0 KB<span style="color:#666">)</span>
        TX errors <span style="color:#40a070">0</span>  dropped <span style="color:#40a070">0</span> overruns <span style="color:#40a070">0</span>  carrier <span style="color:#40a070">0</span>  collisions <span style="color:#40a070">0</span>
</code></pre></div><p>We can also check the routing table, just to have a grasp of what is
going on regarding the network setting:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">$ route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         10.0.2.2        0.0.0.0         UG    <span style="color:#40a070">100</span>    <span style="color:#40a070">0</span>        <span style="color:#40a070">0</span> enp0s3
10.0.2.0        0.0.0.0         255.255.255.0   U     <span style="color:#40a070">0</span>      <span style="color:#40a070">0</span>        <span style="color:#40a070">0</span> enp0s3
10.0.2.2        0.0.0.0         255.255.255.255 UH    <span style="color:#40a070">100</span>    <span style="color:#40a070">0</span>        <span style="color:#40a070">0</span> enp0s3
192.168.56.0    0.0.0.0         255.255.255.0   U     <span style="color:#40a070">0</span>      <span style="color:#40a070">0</span>        <span style="color:#40a070">0</span> enp0s8
</code></pre></div><p>For the display above, we learn that the Host-only network <code>192.168.56.0/24</code> does not
have internet access by itself (even though we can access it using
SSH from the host machine). Internet access is through the NAT network
<code>10.0.2.0/24</code>, with the gateway being <code>10.0.2.2</code> (provided by VirtualBox).</p>
<p>Now we can SSH into free5gc VM using <code>192.168.56.101</code>:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">ssh 192.168.56.101 -l ubuntu
</code></pre></div><p>This is also how we interact with free5gc VM from now on.</p>


  

  
  <hr>
  <footer>

  
    <section>
    <h4></h4>
    <nav class="nav sharing-icons">
      <a class="nav-item" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.free5gc.org%2finstallations%2fstage-3-free5gc-vm%2f" title="Share on Facebook"><span class="fab fa-facebook-f fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.free5gc.org%2finstallations%2fstage-3-free5gc-vm%2f" title="Share on LinkedIn"><span class="fab fa-linkedin-in fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.free5gc.org%2finstallations%2fstage-3-free5gc-vm%2f&amp;text=" title="Tweet this"><span class="fab fa-twitter fa-2x"></span></a>
    </nav>
  </section>


  

  
  </footer>
  

</article> 



      
      <footer class="pt-4 my-md-5 pt-md-5 border-top">
        <div class="row">
          <div class="col-12 col-md">
	    <a href="https://www.free5gc.org"><img class="mb-2" src="/img/free5GC.png" alt="" height="32"></a>
            <small class="d-block mb-1 text-muted">&copy; Copyright January 2019 free5GC.org</small>
            <small class="d-block mb-1 text-muted">All rights reserved.</small>
          </div>
          <div class="col-6 col-md">
            <h5>Contact:</h5>
            <ul class="list-unstyled text-small">
              <li>
                <a class="link-secondary" href="mailto:free5GC.org@gmail.com"
                   target="_self"><span style="text-decoration:underline">free5GC.org@gmail.com</span>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </footer>
      
    </div> <!-- /.container-fluid -->
  </body>

</html>

